<style>
	#header {
		font-size: 4.5rem;
		font-family: Arial, sans-serif;
		font-weight: 600;
		text-align: center;
		letter-spacing: .25rem;
		margin-bottom: 1.5rem;
	}
	
	body {
		margin: 2rem;
		background-color: efefef;
		text-align: center;
	}
		
	#gimme {
		padding: 1rem 3rem 1rem 3rem;
		font-size: 1.5rem;
		font-family: Arial, sans-serif;
		font-weight: 600;
		border: 3px solid black;
		box-shadow: 5px 5px #aaaaaa;
		cursor: pointer;
		letter-spacing: .2rem;
		outline: none;
	}
	
	#save {
		padding: 1rem 3rem 1rem 3rem;
		font-size: 1.5rem;
		font-family: Arial, sans-serif;
		font-weight: 600;
		border: 3px solid black;
		box-shadow: 5px 5px #aaaaaa;
		cursor: pointer;
		letter-spacing: .2rem;
		display: none;
		outline: none;
	}
	
	#friendcontainer {
		padding: 3rem; 
		margin: 0 auto;
		margin-bottom: 3rem;
		border: 3px solid black;
		max-width: 450px;
		min-width: 450px;
		min-height: 450px;
		display: none;
	}

	#seedcontainer {
		display: none;
	}
	
	#seedlabel {
		padding: 0rem 1rem 0rem 1rem;
		font-size: 1.5rem;
		font-family: Arial, sans-serif;
		font-weight: 600;
		letter-spacing: .12rem;
	}
	
	#seedtxt {
		margin-bottom: 2rem;
		border: 3px solid black;
		font-size: 1.3rem;
		font-family: Arial, sans-serif;
		font-weight: 600;
		box-shadow: 3px 3px #aaaaaa;
		letter-spacing: .11rem;
		outline: none;
	}
	
	#yournewbestfriend {
		max-width: 450px;
		display: none;
	}
	
	@keyframes zoomIn {
		0% {
			opacity: 0;
			transform: scale(0);
		}
		100% {
			opacity: 1;
			transform: scale(1);
		}
	}
	
	@keyframes zoomOut {
		0% {
			opacity: 1;
			transform: scale(1);
		}
		100% {
			opacity: 0;
			transform: scale(0);
		}
	}
	
	
	@keyframes rotateIn {
		0% {
			transform: rotate(-60deg);
		}
		
		5% {
			transform: rotate(-65deg);
		}
		
		55% {
			transform: rotate(3deg);
		}
		
		100% {
			transform: rotate(0deg);
		}
	}
	
	@keyframes rotateLeft {
		0% {
			transform: rotate(0deg);
		}
		55% {
			transform: rotate(-3deg);
		}
		100% {
			transform: rotate(0deg);
		}
	}
	
	@keyframes rotateRight {
		0% {
			transform: rotate(0deg);
		}
		55% {
			transform: rotate(3deg);
		}
		100% {
			transform: rotate(0deg);
		}
	}


	@keyframes rotateInFast {
		0% {
			opacity: 0;
			transform: rotate(-10deg);
		}
		
		3% {
			transform: scale(1.1) rotate(-15deg);
		}
		
		100% {
			opacity: 1;
			transform: scale(1) rotate(0deg);
		}
	}

	
	@keyframes rotateOut {
		0% {
			opacity: 1;
			transform: scale(1) rotate(0deg);
		}
					
		60% {
			opacity: 0;
			transform: scale(0) rotate(-520deg);
		}
		
		100% {
			opacity: 0;
			transform: scale(0) rotate(-520deg);
		}
	}


	.zoomingIn {
		animation: zoomIn 1s forwards; 
	}
	
	.zoomingOut {
		animation: zoomOut 1s forwards; 
	}
	
	.rot8in {
		animation: rotateIn 1s forwards;
	}

	.rot8infast {
		animation: rotateInFast 0.35s forwards;
	}

	.rot8out {
		animation: rotateOut 2s ease forwards; 
	}
	
	.rot8left {
		animation: rotateLeft 0.23s forwards;
	}
	
	.rot8right {
		animation: rotateRight 0.23s forwards;
	}
	
	#canvas {
		display: none;
	}

</style>

<title>MARE GENERATOR</title>

<body>
	<p id="header">MARE Generator</p>
	<div id="friendcontainer">
		<div id="yournewbestfriend"></div>
	</div>
	
	<div id="seedcontainer">
		<label id="seedlabel" for="serverURL">Seed:</label>
		<input type="text" id="seedtxt" name="seedtxt"><br/>
	</div>
	
	<button id="gimme">I want a friend.</button>
	<button id="save">Share my mare</button>

	<canvas id="canvas" width="450" height="450"></canvas>

</body>

<script>
//https://github.com/davidbau/seedrandom
!function(f,a,c){var s,l=256,p="random",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=l-1;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&"object"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,"global"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+"",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),"object"==typeof module&&module.exports){module.exports=n;try{s=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd?define(function(){return n}):c["seed"+p]=n}("undefined"!=typeof self?self:this,[],Math);

var gimme = document.getElementById('gimme');
var save = document.getElementById('save');
var seedtxt = document.getElementById('seedtxt');
var friend = document.getElementById('yournewbestfriend');
var friendcontainer = document.getElementById('friendcontainer');
var seedcontainer = document.getElementById('seedcontainer');
var friendReady = false;
var friendLoaded = false;
seedtxt.disabled = true;
save.disabled = true;

function isMobileDevice() {
	return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

function loadSVG() {
	if (friendLoaded == false) {
		fetch('./real.svg').then(response => response.text()).then(svgData => {
			svgData = svgData.replace(/width="[\d\.]+"/g, 'width="450"');
			svgData = svgData.replace(/height="[\d\.]+"/g, 'height="450"');
			friend.innerHTML = svgData;
			friendLoaded = true;
			prepareColors();
			setColors();
			
		});
	} else if (friendLoaded == true) {
        prepareColors();
        setColors();
	}
}

var letterCounter = 0;

function calcSeed() {
    seed = String(Math.floor(Math.random() * new Date().getTime())).toString();
	console.log(seed);
}

seedtxt.addEventListener('input', function() {
	clearTimeout(animationTimer);
	letterCounter += 1;
	console.log(seedtxt.value);
	(letterCounter % 2 == 0) ? friend.classList.add('rot8left') : friend.classList.add('rot8right');
	friend.addEventListener('animationend', function() {
		friend.classList.remove('rot8left');
		friend.classList.remove('rot8right');
	});
	seed = seedtxt.value
	loadSVG();
});



gimme.addEventListener('click', () => {
	seedcontainer.style.display = "block";
    gimme.innerHTML = "Give me another.";
	calcSeed()
    giveFriend();
});

function sendSVGToCanvas() {
    var svgString = new XMLSerializer().serializeToString(document.querySelector('svg'));
    svgString = svgString.replace(/width="[\d\.]+"/g, 'width="720"');
    svgString = svgString.replace(/height="[\d\.]+"/g, 'height="720"');
	var img = new Image();
    img.src = 'data:image/svg+xml;base64,' + btoa(svgString);
    var canvas = document.getElementById('canvas');
    canvas.width = 720;
    canvas.height = 720;
    var ctx = canvas.getContext('2d');
	
    img.onload = function() {
        ctx.drawImage(img, 0, 0);
        var text = 'Seed: ' + seed;
        var fontSize = 40;
        var x = canvas.width;
        var y = 5;
        ctx.font =  '600 40px Arial';
        ctx.letterSpacing = "4px";
        ctx.fillStyle = 'white';
        ctx.strokeStyle = 'black'; 
        ctx.lineWidth = 6;
        ctx.textAlign = 'right';
        ctx.textBaseline = 'top';
        ctx.strokeText(text, x, y);
        ctx.fillText(text, x, y); 
		
		if (isMobileDevice() || /Firefox/i.test(navigator.userAgent)) { 
			var link = document.createElement('a');
			link.download = seed + '.png';
			canvas.toBlob(function(blob) {
				var link = document.createElement('a');
				link.href = URL.createObjectURL(blob);
				link.click();
			}, 'image/png');

		} else {
			canvas.toBlob(function(blob) {
				var item = new ClipboardItem({ 'image/png': blob });
				navigator.clipboard.write([item]).then(function() {
					alert('Your mare has been copied to the clipboard.\nSeed: ' + seed);
				}, function(error) {
					alert('Unable to copy image to clipboard:', error);
				});
			});
		}
    };
}

save.addEventListener('click', () => {
	sendSVGToCanvas(); 
});


function randomHexColorCode(seed) {
  Math.seedrandom(seed);
  let n = (Math.random() * 0xfffff * 1000000).toString(16);
  return '#' + n.slice(0, 6);
};


function LightenDarkenColor(col, amt) {
  
    var usePound = true;
  
    if (col[0] == "#") {
        col = col.slice(1);
        usePound = true;
    }
 
    var num = parseInt(col, 16);
 
    var r = ((num >> 16) + amt) < 0 ? 0 : ((num >> 16) + amt > 255 ? 255 : (num >> 16) + amt);
    var b = (((num >> 8) & 0x00FF) + amt) < 0 ? 0 : (((num >> 8) & 0x00FF) + amt > 255 ? 255 : ((num >> 8) & 0x00FF) + amt);
    var g = ((num & 0x0000FF) + amt) < 0 ? 0 : ((num & 0x0000FF) + amt > 255 ? 255 : (num & 0x0000FF) + amt);
 
    return (usePound ? "#" : "") + ((1 << 24) + (r << 16) + (b << 8) + g).toString(16).slice(1);
  
}
function prepareColors() { 
	eyeColor = randomHexColorCode(seed)

	maneBackColor = randomHexColorCode(seed + Math.random())
	maneBackColorDarktone 	= LightenDarkenColor(maneBackColor, -15)
	maneBackColorOutline     = LightenDarkenColor(maneBackColor, -35)
	
	maneFrontColor = randomHexColorCode(seed + Math.random())
	maneFrontColorOutline     = LightenDarkenColor(maneFrontColor, -35)

	bodyColor = randomHexColorCode(seed + Math.random())
	bodyColorOutline     = LightenDarkenColor(bodyColor, -65)
	bodyColorBack        = LightenDarkenColor(bodyColor, -32)
	bodyColorBackOutline = LightenDarkenColor(bodyColor, -75)
}

runs = 0;

function positionPathBefore(path, target) {
	var src = document.getElementById(path);
	var destination = document.getElementById(target);

	src.parentNode.removeChild(src);
	destination.parentNode.insertBefore(src, destination);
}

function setColors() {

	unicornPaths = [
		"horn-patch-outline",
		"horn-patch-fill",
		"horn-outline",
		"horn-fill",
	]
	
	pegasusPaths = [
		"wing-fill",
		"wing-outline",
		"wing-base-fill"
	]
	
	allManePaths = [
		"mane1-tail-upper-outline",
		"mane1-tail-upper-fill",
		"mane1-tail-lower-outline",
		"mane1-tail-lower-fill",
		"mane1-upper-outline",
		"mane1-upper-fill",
		"mane1-lower-outline",
		"mane1-lower-fill",
		"mane1-upper-side-fill",
		"mane1-upper-side-outline",
		"mane1-lower-side-outline",
		"mane1-lower-side-fill",
		"mane1-upper-end-side-outline",
		"mane1-upper-end-side-fill",
		
		"mane2-tail-outline",
		"mane2-tail-fill",
		"mane2-side-outline",
		"mane2-side-fill",
		"mane2-outline",
		"mane2-fill",
		
		"mane3-upper-outline",
		"mane3-upper-fill",		
		"mane3-lower-outline",	
		"mane3-lower-fill",
		"mane3-side-upper-outline",	
		"mane3-side-upper-fill",	
		"mane3-side-lower-outline",
		"mane3-side-lower-fill",
		"mane3-tail-upper-outline",
		"mane3-tail-upper-fill",
		"mane3-tail-lower-outline",
		"mane3-tail-lower-fill",
		
		"mane4-outline",
		"mane4-fill",
		"mane4-side-outline",		
		"mane4-side-fill",		
		"mane4-tail-outline", 
		"mane4-tail-fill",
		"mane4-horn-patch-outline",
		"mane4-horn-patch-fill",
		
		"mane5-tail-fill",
		"mane5-tail-outline",
		"mane5-side-fill",
		"mane5-side-outline",
		"mane5-fill",
		"mane5-outline",
		"mane5-fill-loose",
		"mane5-outline-loose",
	]
	
	pointyMane1Paths = [
		"mane3-upper-outline",
		"mane3-upper-fill",		
		"mane3-lower-outline",	
		"mane3-lower-fill",
		"mane3-side-upper-outline",
		"mane3-side-upper-fill",	
		"mane3-side-lower-outline",
		"mane3-side-lower-fill",	
		"mane3-tail-upper-outline",
		"mane3-tail-upper-fill",
		"mane3-tail-lower-outline",
		"mane3-tail-lower-fill",
	]
	
	pointyMane2Paths = [
		"mane1-tail-upper-outline",
		"mane1-tail-upper-fill",
		"mane1-tail-lower-outline",
		"mane1-tail-lower-fill",
		"mane1-upper-outline",
		"mane1-upper-fill",
		"mane1-lower-outline",
		"mane1-lower-fill",
		"mane1-upper-side-fill",
		"mane1-upper-side-outline",
		"mane1-lower-side-outline",
		"mane1-lower-side-fill",
		"mane1-upper-end-side-outline",
		"mane1-upper-end-side-fill",
	]
	
	doodlyMane1Paths = [
		"mane2-tail-outline",
		"mane2-tail-fill",
		"mane2-side-outline",
		"mane2-side-fill",
		"mane2-outline",
		"mane2-fill",
	]
	
	poofyMane1Paths = [
		"mane4-outline",
		"mane4-fill",
		"mane4-side-outline",		
		"mane4-side-fill",		
		"mane4-tail-outline", 
		"mane4-tail-fill",
		"mane4-horn-patch-outline",
		"mane4-horn-patch-fill",
	]
	
	poofyMane2Paths = [
		"mane5-tail-fill",
		"mane5-tail-outline",
		"mane5-side-fill",
		"mane5-side-outline",
		"mane5-fill",
		"mane5-outline",
		"mane5-fill-loose",
		"mane5-outline-loose",
	]
	
	eyeStops = [
		"stop27",
		"stop24",
	]
	
	muzzles = [
		"muzzle-smile-fill",
		"muzzle-smile-mouth",
		"muzzle-smile-outline",
		"muzzle-scrunch-fill",
		"muzzle-scrunch-outline",
	]
	
	muzzleScrunch = [
		"muzzle-scrunch-fill",
		"muzzle-scrunch-outline",
	]
	
	muzzleSmile = [
		"muzzle-smile-fill",
		"muzzle-smile-mouth",
		"muzzle-smile-outline",
	]
	
	randomAlicorn = Math.random();
	alicornChance = randomAlicorn < 0.0052;

	randomUnicorn = Math.random();
	unicornChance = (!alicornChance) && (randomUnicorn < 0.33); 

	randomPegasus = Math.random();
	pegasusChance = (!alicornChance) && (!unicornChance) && (randomPegasus < 0.33);

	randomScrunch = Math.random();
	scrunchChance = randomScrunch < 0.01;

	randomPointyMane = Math.random();
	pointyManeChance = randomPointyMane < 0.20;

	randomPointyMane2 = Math.random();
	pointyMane2Chance = (!pointyManeChance) && randomPointyMane2 < 0.20;

	randomDoodlyMane = Math.random();
	doodlyManeChance = (!pointyManeChance) && (!pointyMane2Chance) && randomDoodlyMane < 0.20;

	randomPoofyMane = Math.random();
	poofyManeChance = (!doodlyManeChance) && (!pointyManeChance) && (!doodlyManeChance) && (randomPoofyMane < 0.20);

	randomAlcoholicMane = Math.random();
	alcoholicManeChance = (!poofyManeChance) && (!doodlyManeChance) && (!pointyMane2Chance) && (!pointyManeChance) && (randomAlcoholicMane < 0.20);


	//console.log("Random Scrunch:", randomScrunch);
	//console.log("Random Alicorn:", randomAlicorn);
	//console.log("Random Unicorn:", randomUnicorn);
	//console.log("Random Pegasus:", randomPegasus);
	//console.log("Random pointyMane:", randomPointyMane);
	//console.log("Random pointyMane2:", randomPointyMane2);
	//console.log("Random doodlyMane:", randomDoodlyMane);
	//console.log("Random poofyMane:", randomPoofyMane);

	if (alicornChance) {
		alert("You found a rare alicorn! Make sure to preserve it for future studies.");
	}

	var paths = friend.querySelectorAll('[d]');

	paths.forEach(function(path) {
		var fillColor = path.getAttribute('fill');

		// Disable most features at onse, then you can put the one you want back on later judging by its type.
		if (allManePaths.includes(path.id) || pegasusPaths.includes(path.id) || unicornPaths.includes(path.id) || muzzles.includes(path.id)) {
			path.style.display = 'none'; 
		}
		
		if (fillColor == "#ff0000") {
			path.style.setProperty('fill', bodyColor, 'important');
		}
		
		if (!fillColor || fillColor == "#000000") {
			path.style.setProperty('fill', bodyColorOutline, 'important');
		}
		
		if (fillColor == "#000006") {
			path.style.setProperty('fill', 'black', 'important');
		}
		
		if (fillColor == "#494949") {
			path.style.setProperty('fill', bodyColorBackOutline, 'important');
		}
		if (fillColor == "#b10000") {
			path.style.setProperty('fill', bodyColorBack, 'important');
		}
		
		if (fillColor == "#00ffff") {
			path.style.setProperty('fill', maneBackColor, 'important');
		}
		
		if (fillColor == "#94008c") {
			path.style.setProperty('fill', maneBackColorDarktone, 'important');
		}
		
		if (fillColor == "#3dff00") {
			path.style.setProperty('fill', maneFrontColor, 'important');
		}

 		if (fillColor == "#0c0090") {
			path.style.setProperty('fill', maneBackColorOutline, 'important');
		}

		if (fillColor == "#0000ff") {
			path.style.setProperty('fill', maneFrontColorOutline, 'important');
		}

		if (scrunchChance) {
			if (muzzleScrunch.includes(path.id)) 
				path.style.display = 'block'; 
		} else {
			if (muzzleSmile.includes(path.id)) 
				path.style.display = 'block'; 
		} 

		if (alicornChance) {
			if (unicornPaths.includes(path.id)) 
				path.style.display = 'block'; 
			if (pegasusPaths.includes(path.id)) 
				path.style.display = 'block'; 
		} else if (unicornChance) {
			if (pegasusPaths.includes(path.id)) 
				path.style.display = 'block'; 
		} else if (pegasusChance) {
			if (unicornPaths.includes(path.id)) 
				path.style.display = 'block'; 
		}


		if (doodlyManeChance) {
			if (doodlyMane1Paths.includes(path.id)) 
				path.style.display = 'block'; 
			
			if (path.id == "horn-patch-fill")
				path.style.display = 'none'; 
		} else if (pointyMane2Chance) {
			if (pointyMane2Paths.includes(path.id)) 
				path.style.display = 'block';
		} else if (poofyManeChance) {
			if (poofyMane1Paths.includes(path.id)) 
				path.style.display = 'block';
			
			positionPathBefore("horn-fill",    "mane4-horn-patch-fill")
			positionPathBefore("horn-outline", "mane4-horn-patch-fill")
		} else if (alcoholicManeChance) {
			if (poofyMane2Paths.includes(path.id)) 
				path.style.display = 'block';
				
			positionPathBefore("horn-fill", "horn-patch-fill")
			positionPathBefore("horn-outline", "horn-patch-outline")
		} else {
			if (pointyMane1Paths.includes(path.id)) 
				path.style.display = 'block'; 
			if (path.id == "horn-patch-fill")
				path.style.display = 'none'; 
			if (path.id == "horn-patch-outline")
				path.style.display = 'none'; 

			positionPathBefore("horn-fill", "mane3-lower-outline")
			positionPathBefore("horn-outline", "mane3-lower-outline")
		}
	});
	
	
	var gradients = friend.querySelectorAll('linearGradient');

	gradients.forEach(function(gradient) {
		var stops = gradient.querySelectorAll('stop');
		stops.forEach(function(stop) {
			if (eyeStops.includes(stop.id)) {
				stop.setAttribute('stop-color', eyeColor);
			}
		});
	});
}



function giveFriend() { 
    if (!friendReady) {
		loadSVG();
		save.style.display = "inline-block";
		
        friend.style.display = "block";
        friendcontainer.style.display = "block";
		
		if (runs == 0) {
			friend.classList.add('zoomingIn', 'rot8in');
			friendcontainer.classList.add('zoomingIn');
			runs += 1;
		} else {
			friend.classList.add('zoomingIn', 'rot8infast');
		}

        friendReady = true;
		
       
		save.disabled = true;
		seedtxt.value = seed;
		seedtxt.disabled = true;
		gimme.disabled = true;
		animationTimer = setTimeout(() => {
			friendcontainer.classList.remove('zoomingIn');
			friend.classList.remove('zoomingIn', 'rot8in', 'rot8infast');
			save.disabled = false;
			gimme.disabled = false;
			seedtxt.value = seed;
			seedtxt.disabled = false;
		}, 1000);

	} else if (friendReady) {
		friend.classList.add('zoomingOut', 'rot8out');
		gimme.disabled = true;
		save.disabled = true;
		seedtxt.value = seed;
		seedtxt.disabled = true;
		friend.addEventListener('animationend', function() {
			friend.classList.remove('zoomingOut', 'rot8out');
			friendReady = false;
			giveFriend();
		}, { once: true });
	}
}
</script>